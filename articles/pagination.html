<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Pagination • beekeeper</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.4.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.4.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Pagination">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">beekeeper</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.4.0.9000</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../articles/beekeeper.html">Get started</a></li>
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/pagination.html">Pagination</a></li>
  </ul>
</li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/jonthegeek/beekeeper/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.svg" class="logo" alt=""><h1>Pagination</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/jonthegeek/beekeeper/blob/main/vignettes/pagination.Rmd" class="external-link"><code>vignettes/pagination.Rmd</code></a></small>
      <div class="d-none name"><code>pagination.Rmd</code></div>
    </div>

    
    
<p>Many APIs implement some form of pagination: they break up large
datasets into “pages” of results, and return a single page at a time. To
get the full dataset, we need to make multiple requests, and combine the
results.</p>
<p>Unfortunately, there isn’t a standard way to document API pagination.
Therefore, we cannot automatically generate pagination code. You will
need to edit your <code>010-call.R</code> file to implement
pagination.</p>
<div class="section level2">
<h2 id="finding-pagination-information">Finding pagination information<a class="anchor" aria-label="anchor" href="#finding-pagination-information"></a>
</h2>
<p>Before you can implement pagination in your package, you will need to
find out how the API implements pagination. You can usually find this
information in the API documentation. Sometimes this information is in a
separate “Pagination” section at the top of the documentation. Often it
is described in the individual endpoint documentation (even if it is
separately described in its own section). If it isn’t clearly described,
watch for pagination-related endpoint parameters, such as
<code>page</code>, <code>pageSize</code>, <code>perPage</code>
<code>limit</code>, <code>offset</code>, or <code>cursor</code>.</p>
<p>For more tips on finding pagination information, see <a href="https://r4ds.github.io/bookclub-wapir/slides/httr2/httr2-pagination.html" class="external-link">How
can I get a lot of data from an API?</a> in <a href="https://r4ds.github.io/bookclub-wapir/" class="external-link">Web APIs with R</a>.</p>
</div>
<div class="section level2">
<h2 id="implementing-pagination">Implementing pagination<a class="anchor" aria-label="anchor" href="#implementing-pagination"></a>
</h2>
<p>The <a href="https://httr2.r-lib.org/reference/req_perform_iterative.html" class="external-link">req_perform_iterative()
function from {httr2}</a> helps to implement pagination. It uses the
request and some helper functions to create a new request to fetch the
next page. This family of functions is experimental, so be sure to check
the latest documentation in case the functions have changed.</p>
<p>To implement pagination in your package, you will need to edit the
<code>010-call.R</code> file generated by {beekeeper}. By default, the
perform step is handled by
<code><a href="https://nectar.api2r.org/reference/req_perform_opinionated.html" class="external-link">nectar::req_perform_opinionated()</a></code></p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">resp</span> <span class="op">&lt;-</span> <span class="fu">nectar</span><span class="fu">::</span><span class="fu"><a href="https://nectar.api2r.org/reference/req_perform_opinionated.html" class="external-link">req_perform_opinionated</a></span><span class="op">(</span><span class="va">req</span><span class="op">)</span></span></code></pre></div>
<p>This function calls <code><a href="https://httr2.r-lib.org/reference/req_perform.html" class="external-link">httr2::req_perform()</a></code> if you only
give it a <code>req</code> object, or
<code><a href="https://httr2.r-lib.org/reference/req_perform_iterative.html" class="external-link">httr2::req_perform_iterative()</a></code> if you supply an iteration
helper function in the <code>next_req</code> parameter. For example, if
every endpoint of your API uses a <code>page</code> parameter to
paginate, you could replace the line above with something like this:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">is_complete</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">resp</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/logical.html" class="external-link">as.logical</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="fu">httr2</span><span class="fu">::</span><span class="fu"><a href="https://httr2.r-lib.org/reference/resp_body_raw.html" class="external-link">resp_body_json</a></span><span class="op">(</span><span class="va">resp</span><span class="op">)</span><span class="op">$</span><span class="va">data</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span><span class="va">resp</span> <span class="op">&lt;-</span> <span class="fu">nectar</span><span class="fu">::</span><span class="fu"><a href="https://nectar.api2r.org/reference/req_perform_opinionated.html" class="external-link">req_perform_opinionated</a></span><span class="op">(</span></span>
<span>  <span class="va">req</span>, </span>
<span>  next_req <span class="op">=</span> <span class="fu">httr2</span><span class="fu">::</span><span class="fu"><a href="https://httr2.r-lib.org/reference/iterate_with_offset.html" class="external-link">iterate_with_offset</a></span><span class="op">(</span><span class="st">"page"</span>, resp_complete <span class="op">=</span> <span class="va">is_complete</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>By default, <code><a href="https://nectar.api2r.org/reference/req_perform_opinionated.html" class="external-link">nectar::req_perform_opinionated()</a></code> only
returns 2 responses (<code>max_reqs = 2</code>). Once you have verified
that your pagination strategy works, you will likely want to increase
this limit, usually to <code>Inf</code>.
<code><a href="https://nectar.api2r.org/reference/req_perform_opinionated.html" class="external-link">nectar::req_perform_opinionated()</a></code> also implements a basic
<code><a href="https://httr2.r-lib.org/reference/req_retry.html" class="external-link">httr2::req_retry()</a></code> to try each request up to 3 times, using
the default <code>httr2::retry_retry()</code> settings to decide if a
failure is transient.</p>
</div>
<div class="section level2">
<h2 id="more-complicated-pagination">More complicated pagination<a class="anchor" aria-label="anchor" href="#more-complicated-pagination"></a>
</h2>
<p>If you would like to implement more complex pagination, or apply
other transformations to the <code>req</code> object such as
<code><a href="https://httr2.r-lib.org/reference/req_retry.html" class="external-link">httr2::req_retry()</a></code> or <code><a href="https://httr2.r-lib.org/reference/req_throttle.html" class="external-link">httr2::req_throttle()</a></code>,
you can create your own <code>perform</code> function. I name these
functions <code>{api_abbr}_req_perform()</code>. For example, this is
the <code>perform</code> function for the {fecapi} package:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">.fec_req_perform</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">req</span>,</span>
<span>                             <span class="va">pagination</span>,</span>
<span>                             <span class="va">per_page</span>,</span>
<span>                             <span class="va">max_results</span>,</span>
<span>                             <span class="va">max_reqs</span>,</span>
<span>                             <span class="va">call</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">next_req</span> <span class="op">&lt;-</span> <span class="fu">.choose_pagination_fn</span><span class="op">(</span><span class="va">pagination</span>, call <span class="op">=</span> <span class="va">call</span><span class="op">)</span></span>
<span>  <span class="va">max_reqs</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">min</a></span><span class="op">(</span><span class="va">max_reqs</span>, <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">ceiling</a></span><span class="op">(</span><span class="va">max_results</span> <span class="op">/</span> <span class="va">per_page</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="fu">nectar</span><span class="fu">::</span><span class="fu"><a href="https://nectar.api2r.org/reference/req_perform_opinionated.html" class="external-link">req_perform_opinionated</a></span><span class="op">(</span></span>
<span>    <span class="va">req</span>,</span>
<span>    next_req <span class="op">=</span> <span class="va">next_req</span>,</span>
<span>    max_reqs <span class="op">=</span> <span class="va">max_reqs</span></span>
<span>  <span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="va">.choose_pagination_fn</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">pagination</span>, <span class="va">call</span> <span class="op">=</span> <span class="fu">rlang</span><span class="fu">::</span><span class="fu"><a href="https://rlang.r-lib.org/reference/stack.html" class="external-link">caller_env</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">pagination</span> <span class="op">&lt;-</span> <span class="fu">.validate_pagination</span><span class="op">(</span><span class="va">pagination</span>, <span class="va">call</span><span class="op">)</span></span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/switch.html" class="external-link">switch</a></span><span class="op">(</span><span class="va">pagination</span>,</span>
<span>    basic <span class="op">=</span> <span class="fu">.iterator_fn_basic</span><span class="op">(</span><span class="op">)</span>,</span>
<span>    none <span class="op">=</span> <span class="cn">NULL</span></span>
<span>  <span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="va">.validate_pagination</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">pagination</span>, <span class="va">call</span> <span class="op">=</span> <span class="fu">rlang</span><span class="fu">::</span><span class="fu"><a href="https://rlang.r-lib.org/reference/stack.html" class="external-link">caller_env</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="fu">rlang</span><span class="fu">::</span><span class="fu"><a href="https://rlang.r-lib.org/reference/arg_match.html" class="external-link">arg_match0</a></span><span class="op">(</span></span>
<span>    <span class="va">pagination</span>,</span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"none"</span>, <span class="st">"basic"</span><span class="op">)</span>,</span>
<span>    error_call <span class="op">=</span> <span class="va">call</span></span>
<span>  <span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="va">.iterator_fn_basic</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="fu">httr2</span><span class="fu">::</span><span class="fu"><a href="https://httr2.r-lib.org/reference/iterate_with_offset.html" class="external-link">iterate_with_offset</a></span><span class="op">(</span></span>
<span>    <span class="st">"page"</span>,</span>
<span>    resp_pages <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">resp</span><span class="op">)</span> <span class="op">{</span></span>
<span>      <span class="fu">httr2</span><span class="fu">::</span><span class="fu"><a href="https://httr2.r-lib.org/reference/resp_body_raw.html" class="external-link">resp_body_json</a></span><span class="op">(</span><span class="va">resp</span><span class="op">)</span><span class="op">$</span><span class="va">pagination</span><span class="op">$</span><span class="va">pages</span></span>
<span>    <span class="op">}</span></span>
<span>  <span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
<p>Within <code>010-call.R</code>, I apply the function like this:</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span>  <span class="va">resp</span> <span class="op">&lt;-</span> <span class="fu">.fec_req_perform</span><span class="op">(</span></span>
<span>    <span class="va">req</span>,</span>
<span>    pagination <span class="op">=</span> <span class="va">pagination</span>,</span>
<span>    per_page <span class="op">=</span> <span class="va">query</span><span class="op">$</span><span class="va">per_page</span>,</span>
<span>    max_results <span class="op">=</span> <span class="va">max_results</span>,</span>
<span>    max_reqs <span class="op">=</span> <span class="va">max_reqs</span></span>
<span>  <span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="help-us-improve">Help us improve<a class="anchor" aria-label="anchor" href="#help-us-improve"></a>
</h2>
<p>If you find a pattern in pagination implementation from the API
description and/or endpoint function parameters, please <a href="https://github.com/jonthegeek/beekeeper/issues" class="external-link">submit an issue or
a pull request</a> to help us improve the output of this package.</p>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Jon Harmon, R Consortium.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

    </footer>
</div>





  </body>
</html>
